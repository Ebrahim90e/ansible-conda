---

- name: Find installed Conda matching packages
  shell: "{{ conda_tests_conda_executable }} search --json {{ conda_tests_install_example }}"
  register: installed_raw

- name: Filter output
  set_fact:
    installed: "{{ (installed_raw.stdout | from_json | json_query('%s[?installed]' % conda_tests_install_example)) }}"

- name: Ensure expected environment
  assert:
    that: installed | length <= 1

- name: Set return variable
  set_fact:
    example_package:
      installed: "{{ installed | length != 0 }}"
      version: "{{ installed[0].version if installed | length > 0 else False }}"
