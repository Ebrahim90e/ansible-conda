---

- name: install package via conda
  conda:
    name: "{{ conda_tests_install_example }}"
    version: "{{ conda_tests_old_version }}"
    state: present
    executable: "{{ conda_tests_conda_executable }}"
  register: first_install

- include: install-facts.yml

- name: Verify installed
  assert:
    that: first_install.changed
    that: example_package.installed
    that: example_package.version | version_compare(conda_tests_old_version, '=')

- name: install package via conda (again)
  conda:
    name: "{{ conda_tests_install_example }}"
    version: "{{ conda_tests_old_version }}"
    state: present
    executable: "{{ conda_tests_conda_executable }}"
  register: second_install

- name: verify idempotence
  assert:
    that: not second_install.changed
